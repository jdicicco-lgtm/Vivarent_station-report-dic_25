<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Performance — Dicembre 2025</title>
  <link rel="stylesheet" href="./styles.css" />

  <!-- Chart.js + date adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <header class="container">
    <div class="topbar">
      <div>
        <h1>Performance Dashboard</h1>
        <p class="subtitle">Dicembre 2025 → 04 Gennaio 2026</p>
      </div>
      <div id="status" class="status">Caricamento dati…</div>
    </div>
  </header>

  <main class="container">

    <!-- OCCUPAZIONE KPI FISSI (IN ALTO) -->
    <section class="card">
      <div class="card__head">
        <h2>Occupazione per Branch Office (fissa)</h2>
        <p class="muted">Sempre visibile • Non influenzata dai filtri</p>
      </div>
      <div id="occupationKpis" class="kpi-grid"></div>
    </section>

    <!-- FILTRI -->
    <section class="card">
      <div class="card__head">
        <h2>Filtri</h2>
        <p class="muted">Agiscono solo su KPI Revenue / Ancillaries / Incidenti / Prenotazioni e sui grafici collegati.</p>
      </div>

      <div class="filters">
        <div class="field">
          <label>Intervallo date (pick-up)</label>
          <div class="row">
            <input id="dateFrom" type="date" />
            <input id="dateTo" type="date" />
          </div>
          <p class="hint">Puoi selezionare più giorni impostando un range.</p>
        </div>

        <div class="field">
          <label>Branch office</label>
          <select id="branchSelect" multiple></select>
          <p class="hint">Ctrl/Cmd per selezione multipla.</p>
        </div>

        <div class="field">
          <label>Agente</label>
          <select id="agentSelect" multiple></select>
          <p class="hint">Ctrl/Cmd per selezione multipla.</p>
        </div>

        <div class="actions">
          <button id="resetBtn" class="btn btn--ghost">Reset</button>
          <button id="applyBtn" class="btn">Applica</button>
        </div>
      </div>
    </section>

    <!-- KPI FISSI: OCCUPAZIONE MEDIA + FLOTTA + MANUTENZIONE -->
    <section class="grid-3">
      <div class="card">
        <div class="card__head">
          <h2>Occupazione media (fissa)</h2>
          <p class="muted">Media semplice delle % branch</p>
        </div>
        <div class="kpi">
          <div class="kpi__value" id="avgOcc">—</div>
          <div class="kpi__label">Media occupazione</div>
        </div>
      </div>

      <div class="card">
        <div class="card__head">
          <h2>Flotta (fissa)</h2>
          <p class="muted">Non cambia con branch office</p>
        </div>
        <div class="kpi">
          <div class="kpi__value" id="fleetTotal">—</div>
          <div class="kpi__label">Veicoli totali</div>
          <div class="kpi__mini"><span>in service</span><strong id="fleetInService">—</strong></div>
        </div>
      </div>

      <div class="card">
        <div class="card__head">
          <h2>Manutenzione (fissa)</h2>
          <p class="muted">Conteggio per Service Type</p>
        </div>
        <canvas id="serviceByType"></canvas>
      </div>
    </section>

    <!-- KPI FILTRABILI -->
    <section class="grid-4">
      <div class="card">
        <div class="card__head">
          <h2>Revenue</h2>
          <p class="muted">Filtrabile</p>
        </div>
        <div class="kpi">
          <div class="kpi__value" id="revTotal">—</div>
          <div class="kpi__label">Totale</div>
          <div class="kpi__mini"><span>revenue/day</span><strong id="revDay">—</strong></div>
        </div>
      </div>

      <div class="card">
        <div class="card__head">
          <h2>Ancillaries</h2>
          <p class="muted">Filtrabile</p>
        </div>
        <div class="kpi">
          <div class="kpi__value" id="ancTotal">—</div>
          <div class="kpi__label">Vendute</div>
          <div class="kpi__mini"><span>ancillaries/day</span><strong id="ancDay">—</strong></div>
          <div class="kpi__mini"><span>incidenti</span><strong id="incTotal">—</strong></div>
        </div>
      </div>

      <div class="card">
        <div class="card__head">
          <h2>Prenotazioni</h2>
          <p class="muted">Filtrabile</p>
        </div>
        <div class="kpi">
          <div class="kpi__value" id="bookTotal">—</div>
          <div class="kpi__label">Totale</div>
        </div>
      </div>

      <div class="card">
        <div class="card__head">
          <h2>Canali</h2>
          <p class="muted">Walk-In evidenziate</p>
        </div>
        <canvas id="channelsDonut"></canvas>
      </div>
    </section>

    <!-- GRAFICI -->
    <section class="grid-2">
      <div class="card">
        <div class="card__head">
          <h2>% Prenotazioni per Provider</h2>
          <p class="muted">Filtrabile</p>
        </div>
        <canvas id="providersBar"></canvas>
      </div>

      <div class="card">
        <div class="card__head">
          <h2>Flotta per Provider (fissa)</h2>
          <p class="muted">Distribuzione</p>
        </div>
        <canvas id="fleetPie"></canvas>
      </div>
    </section>

    <section class="card">
      <div class="card__head">
        <h2>Trend prenotazioni (01/12 → 04/01)</h2>
        <p class="muted">Hover: n prenotazioni, revenue, flotta</p>
      </div>
      <canvas id="trendChart"></canvas>
    </section>

    <section class="card">
      <div class="card__head">
        <h2>Branch Office × Agente</h2>
        <p class="muted">Revenue • Ancillaries • Prenotazioni (filtrabile)</p>
      </div>
      <div class="table-wrap">
        <table id="boAgentTable">
          <thead>
            <tr>
              <th>Branch Office</th>
              <th>Agente</th>
              <th class="num">Revenue</th>
              <th class="num">Ancillaries</th>
              <th class="num">Prenotazioni</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- NUOVO: TUTTI I GIORNI DI DICEMBRE -->
    <section class="card">
      <div class="card__head">
        <h2>Prenotazioni per giorno — Dicembre 2025</h2>
        <p class="muted">Linea giornaliera (01/12 → 31/12) • Filtra per Branch/Agente</p>
      </div>
      <canvas id="decDailyChart"></canvas>
    </section>

    <footer class="foot muted">
      Dataset: REPORT DICEMBRE 25.xlsx → JSON (vedi /data).<br/>
      Suggerimento: standardizzare naming Branch Office tra fogli per join perfetti.
    </footer>

  </main>

  <script src="./app.js"></script>
</body>
</html>
